\documentclass[landscape]{foils} 
\input{../common-preamble-start}
\input{../preamble.tex}
\input{../common-preamble-end}

\begin{document}
\pagecolor{white}
\unitlength=1mm
\begin{center}
{\Large Some of these slides have been borrowed from Dr.\ Paul Lewis, Dr.\ Joe Felsenstein. Thanks!}
\vskip 15mm
\large Paul has many great tools for teaching phylogenetics at his web site: \\
\url{http://hydrodictyon.eeb.uconn.edu/people/plewis}
\end{center}

\myNewSlide
\section*{Tree Searching}
\large
Parsimony and ML give us ways to deciding whether one tree is fits our data better than another tree, but \ldots\\
\begin{center}
\Large How do we find the best tree?\\
(or one that is good enough)
\end{center}

\myNewSlide
\begin{picture}(0,0)(0,0)
	\put(-30,-70){\makebox(0,0)[l]{\includegraphics{../nonfreeimages/pol/POL_exhaustive_1.pdf}}}
\end{picture}
\myNewSlide
\begin{picture}(0,0)(0,0)
	\put(-30,-70){\makebox(0,0)[l]{\includegraphics{../nonfreeimages/pol/POL_exhaustive_2.pdf}}}
\end{picture}
\myNewSlide
\begin{picture}(0,0)(0,0)
	\put(-30,-70){\makebox(0,0)[l]{\includegraphics{../nonfreeimages/pol/POL_exhaustive_3.pdf}}}
\end{picture}

\myNewSlide
\normalsize
\begin{tabular}{r| r | c}
Tips & Number of unrooted (binary) trees\\
\hline
4 & 3 &\\
5 & 15 &\\
6 & 105 &\\
7 & 945 &\\
8 & 10,395 &\\
9 & 135,135 &\\
10 & 2,027,025 &\\
\hline
11 & 34,459,425 &\\
12 & 654,729,075 &\\
13 & 13,749,310,575 &\\
14 & 316,234,143,225 &\\
15 & 7,905,853,580,625 &\\
16 & 213,458,046,676,875 &\\
17 & 6,190,283,353,629,375 &\\
18 & 191,898,783,962,510,625 &\\
19 & 6,332,659,870,762,850,625 &\\
20 & 22,164,309,5476,699,771,875 &\\
\hline
21 & 8,200,794,532,637,891,559,375 &\\
22 & 319,830,986,772,877,770,815,625 &\\
23 & 13,113,070,457,687,988,603,440,625 & $>21$ moles of trees\\
\hline
24 & 563,862,029,680,583,509,947,946,875 &\\
25 & 25,373,791,335,626,257,947,657,609,375 &\\
\end{tabular}

\myNewSlide
For $N$ taxa:
\begin{eqnarray*}
\#\mbox{ unrooted, binary trees}	& = & \prod_{i=3}^{N-1} (2i-3) \\
	& = & \prod_{i=4}^{N} (2i-5) \\
\#\mbox{ rooted, binary trees}	& = & \prod_{i=3}^{N} (2i-3) \\
& = & (2N-3) (\#\mbox{ unrooted, binary trees})\\
\end{eqnarray*}
	
\myNewSlide
\section*{Star decomposition}
\begin{picture}(0,0)(0,0)
\put(0,-50){\makebox(0,0)[l]{\includegraphics{../images/star_decomp1.pdf}}}
\end{picture}

\myNewSlide
\section*{Star decomposition}
\begin{picture}(0,0)(0,0)
\put(0,-50){\makebox(0,0)[l]{\includegraphics{../images/star_decomp2.pdf}}}
\end{picture}

\myNewSlide
\section*{Star decomposition}
\begin{picture}(0,0)(0,0)
\put(0,-50){\makebox(0,0)[l]{\includegraphics{../images/star_decomp3.pdf}}}
\end{picture}

\myNewSlide
\section*{Star decomposition}
\begin{itemize}
	\item Very greedy. Once a pair of species are joined, they will not be separated.
	\item Neighbor-joining is star decomposition under the balanced minimum evolution criterion
\end{itemize}

% \myNewSlide
% \begin{picture}(0,0)(0,0)
% \put(-30,-90){\makebox(0,0)[l]{\includegraphics{../images/first_100_num_first_step_star_decomp.pdf}}}
% \end{picture}

% % \myNewSlide
% % \begin{picture}(0,0)(0,0)
% % \put(-30,-90){\makebox(0,0)[l]{\includegraphics{../images/first_100_num_star_decomp.pdf}}}
% % \end{picture}

% \myNewSlide

% \begin{picture}(0,0)(0,0)
% \put(-30,-90){\makebox(0,0)[l]{\includegraphics{../images/num_star_decomp_loglog.pdf}}}
% \end{picture}

% \myNewSlide
% \section*{Star decomposition}Number of trees scored for $N$ taxa (if we decrease $i$ in the summation):
% 	\begin{eqnarray*}
% 	\#\mbox{ trees scored}	& = & 3 \sum_{i=N}^{5} {i \choose 2} \\
% 		& = & 3\sum_{i=N}^{5} \frac{i(i-1)}{2} 
% 	\end{eqnarray*}
% 		Thus, star decomposition is $O(N^3)$. 
		
% 		For N=10:
% 		\[158 = 45 + 36 + 28 + 21 + 15 + 10 + 3\]

% \myNewSlide
% \section*{Star decomposition can fail even when there is no homoplasy}
% \begin{center}\begin{table}[htdp]
% \begin{center}
% \begin{tabular}{|c|c|}
% \hline
% A &	0000{\color{red}00} \\
% B &	0000{\color{red} 00} \\
% C &	1100{\color{red} 00} \\
% D &	1100{\color{red} 00} \\
% E &	1010{\color{red} 11} \\
% F &	1011{\color{red} 11} \\ 
% G &	1011{\color{red} ??} \\ 
% \hline
% \end{tabular}
% \end{center}
% \end{table}%
% \end{center}
% Star decomposition (under parsimony) will join E and F in the first step based on characters 5 and 6 (shown in red), even though (((A,B),(C,D)),E,(F,G)) shows no homoplasy.
\myNewSlide
\section*{Stepwise addition}
\begin{picture}(0,0)(0,0)
\put(-10,-50){\makebox(0,0)[l]{\includegraphics{../images/stepwise1.pdf}}}
\end{picture}

\myNewSlide
\section*{Stepwise addition}
\begin{picture}(0,0)(0,0)
\put(-10,-50){\makebox(0,0)[l]{\includegraphics{../images/stepwise2.pdf}}}
\end{picture}

\myNewSlide
\section*{Stepwise addition}
\begin{picture}(0,0)(0,0)
\put(-10,-50){\makebox(0,0)[l]{\includegraphics{../images/stepwise3.pdf}}}
\end{picture}

% \myNewSlide
% \section*{Stepwise addition}
% \begin{itemize}
% 	\item Greedy, but can introduce a new taxon on the path between taxa that have already been joined.
% 	\item The tree can depend on the input order of the taxa
% 	\item Number of trees scored for $N$ taxa :
% 	\begin{eqnarray*}
% 	 \#\mbox{ trees scored}	& = & \sum_{i=3}^{N-1} {(2i-3)} \\
% 		& = & (N-1)(N-3) 
% 	\end{eqnarray*}
% 		Thus, stepwise addition is $O(N^2)$. For N=10:
% 		\[63 = 3 + 5 + 7 + 9 + 11 + 13 + 15\]
% \end{itemize}


% \myNewSlide
% \section*{Branch and bound}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/bandb-1.pdf}}}
% \put(80, 0){\normalsize Construct and score an initial estimate of the tree}
% \end{picture}

% \myNewSlide
% \section*{Branch and bound}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/bandb-2.pdf}}}
% \put(40, -15){\normalsize Initial tree}
% \put(80, 0){\normalsize Start building a new tree of three taxa}
% \end{picture}

% \myNewSlide
% \section*{Branch and bound}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/bandb-2-5.pdf}}}
% \put(40, -15){\normalsize Initial tree}
% \put(80, 0){\normalsize Consider all positions for the next taxon}
% \end{picture}

% \myNewSlide
% \section*{Branch and bound}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/bandb-3.pdf}}}
% \put(40, -15){\normalsize Initial tree}
% \put(80, 0){\normalsize Score all of these trees}
% \end{picture}

% \myNewSlide
% \section*{Branch and bound}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/bandb-4.pdf}}}
% \put(40, -15){\normalsize Initial tree}
% \put(70, 0){\normalsize Consider adding the next taxon to all viable backbone trees}
% \put(105, -41){\normalsize Reject for exceeding}
% \put(105, -51){\normalsize the bound}
% \put(105, -80){\normalsize Reject for exceeding}
% \put(105, -90){\normalsize the bound}
% \end{picture}

% \myNewSlide
% \section*{Branch and bound}
% \begin{itemize}
% 	\item Guaranteed to find all of the optimal trees.
% 	\item Relies on the fact that the score always gets worse as you add taxa.
% 	\item Can be as fast as stepwise addition (if you have lots of very clean data).
% 	\item Can be as slow as an exhaustive search (if you have little data and/or data with lots of conflict).
% 	\item Bound can be tightened by adding a lower bound on the number of steps to be added when you add more taxa to the tree (based on new forms of character conflict in unattached taxa).
% \end{itemize}

\myNewSlide
\section*{Heuristic hill-climbing}
Problem:
\begin{compactitem}
   \item Stepwise addition and star decomp. may not return the best tree
   \item exhaustive searching is infeasible.
\end{compactitem}

hill-climbing:
\begin{compactenum}
	\item Start with a tree
	\item Score the tree
	\item Consider a new tree within the neighborhood of the current tree:
	\begin{compactenum}
		\item Score the new tree.
		\item If the new tree has a better tree, use it as the ``current tree''
		\item Stop if there are no other trees within the neighborhood to consider.
	\end{compactenum}
\end{compactenum}
These are {\bf not} guaranteed to find even one of the optimal trees.

The most common way to explore the neighborhood of a tree is to swap the branches of the tree to construct similar trees.

\myNewSlide
\includepdf[pages={2-19}]{../nonfreeimages/joe/joe_week2.pdf} 

\myNewSlide
\section*{Nearest Neighbor Interchanges searches}
\begin{compactenum}
	\item Consider the two possible NNI neighbors ``around'' each internal edge in the tree
	\item Return the tree set of trees that is at least as good as all of the NNI neighbors.
	\item Number of rearrangements scored {\em per tree} $N$ taxa :
		\[\#\mbox{ rearrangements scored}	= 2\times(N-3) \]
		But, there is no upper bound on the number of trees encountered on the path from the initial tree to the final tree.
\end{compactenum}

\myNewSlide
\section*{Schoenberg graph -- edges connect NNI neighbors}
\begin{picture}(0,0)(0,0)
\put(-30,-50){\makebox(0,0)[l]{\includegraphics{../images/schoenberg.pdf}}}
\end{picture}

% \myNewSlide
% \section*{Tree ``Islands'' possible}
% An $Op-L$ tree island {\em sensu} Maddison( 1991):
% A set of trees with score $\leq L$ that are connected to each other by $Op$ operations such that you can get from any tree in the set to any other tree by repeated $Op$ changes and all intermediate trees along the path are also members of the set.

\myNewSlide
\section*{Tree ``Islands'' (Maddison, 1991) are possible}
The following Schoenberg graph shows the scores of the 15 trees on the following dataset (contrived data by POL):
\begin{center}\begin{verbatim}
A	ACGCAGGT
B	ATGGTGAT
C	GCTCACGG
D	ACTGTCGT
E	GTTCTGAG
\end{verbatim}\end{center}

\myNewSlide
\section*{Schoenberg graph with parsimony scores}
\begin{picture}(0,0)(0,0)
\put(-30,-50){\makebox(0,0)[l]{\includegraphics{../images/schoenberg_scored.pdf}}}
\end{picture}

% \myNewSlide
% \section*{Schoenberg graph showing the single NNI-15 island}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/schoenberg_15_island.pdf}}}
% \end{picture}

% \myNewSlide
% \section*{Schoenberg graph showing the single NNI-14 island}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/schoenberg_14_island.pdf}}}
% \end{picture}

% \myNewSlide
% \section*{Schoenberg graph showing the both NNI-13 islands}
% \begin{picture}(0,0)(0,0)
% \put(-10,-70){\makebox(0,0)[l]{\includegraphics{../images/schoenberg_13_island.pdf}}}
% \end{picture}

\myNewSlide
\section*{Tree Islands implications}
\Large
\begin{compactenum}
	\item Islands can be larger than 1 tree -- so we must consider ties if we want to find all optimal trees.
	\item There can be more than 1 island for good scores: swapping to completion on all optimal trees found in a search is not guaranteed to succeed.
	\item The delimitation of an island depends on tree changing operation used.
\end{compactenum}
\large


\myNewSlide
\section*{Subtree Pruning Regrafting (SPR) and Tree Bisection Reconnection (TBR)}
\begin{picture}(0,0)(0,0)
\put(-10,-50){\makebox(0,0)[l]{\includegraphics[scale=0.9]{../images/sprtbr.pdf}}}
\put(5,-72){\normalsize SPR maintains}
\put(5,-82){\normalsize subtree rooting}
\put(90,-118){\normalsize TBR tries all}
\put(90,-128){\normalsize possible rootings}
\end{picture}

\myNewSlide
\section*{1-Edge-contract Refine}
\begin{picture}(0,0)(0,0)
\put(-10,-50){\makebox(0,0)[l]{\includegraphics[scale=0.9]{../images/1ecr.pdf}}}
\end{picture}

\myNewSlide
\section*{2-Edge-contract Refine}
\begin{picture}(0,0)(0,0)
\put(-10,-50){\makebox(0,0)[l]{\includegraphics[scale=0.9]{../images/2ecr.pdf}}}
\end{picture}

\myNewSlide
\section*{Heuristics explore ``Tree Space''}
\begin{picture}(0,0)(0,0)
\put(-10,-50){\makebox(0,0)[l]{\includegraphics{../images/landscape.pdf}}}
\put(125, -20){\normalsize Many commonly-used methods}
\put(125, -30){\normalsize are ``hill-climbers.''}
\put(125, -50){\normalsize Multiple optima found by}
\put(125, -60){\normalsize repeating searches from}
\put(125, -70){\normalsize different origins.}
\put(125, -90){\normalsize Severity of the problem}
\put(125, -100){\normalsize of multiple optima}
\put(125, -110){\normalsize depends on step size.}
\end{picture}

\myNewSlide
\section*{Branch-swapping tradeoff}
\Large
Using more drastic moves (such as TBR instead of NNI):
\begin{compactitem}
	\item[{\bf +}] you can jump between ``hills''
	\item[{\bf --}] many neighboring trees to score
	\item[{\bf --}] if your current tree is good, high \% of neighbors have much worse likelihood.
\end{compactenum}
\large


\myNewSlide
\section*{Nested optimizaton}
Recall that we have to optimize parameters for each tree:

\url{http://phylo.bio.ku.edu/mephytis/brlen-opt.html}


\myNewSlide
\section*{Need to get branch support}
Recall that bootstrapping is even more expensive:

\url{http://phylo.bio.ku.edu/mephytis/boot-sample.html}


\end{document}

